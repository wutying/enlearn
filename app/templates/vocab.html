{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>å–®å­—æœ¬</h2>
  <p class="section-lead">
    ç›®å‰å…±æ”¶è— <strong>{{ entries|length }}</strong> å€‹å–®å­—ï¼Œä»Šæ—¥å¾…è¤‡ç¿’ <strong>{{ due_count }}</strong> å€‹ã€‚
  </p>
  {% if entries %}
    <div class="vocab-list">
      {% for entry in entries %}
        <article class="vocab-item">
          <header class="vocab-item__header">
            <div class="vocab-item__title">
              <h3>
                <span class="vocab-item__word">{{ entry.word }}</span>
                <span class="vocab-item__definition">â€” {{ entry.definition }}</span>
              </h3>
              <p class="vocab-item__meta">
                ä¸‹ä¸€æ¬¡è¤‡ç¿’ï¼š{{ entry.next_review }} Â· é€£å‹ {{ entry.success_streak }} Â· å·²è¤‡ç¿’ {{ entry.review_count }} æ¬¡
              </p>
            </div>
            <div class="vocab-item__actions">
              <button type="button" class="speak-button" data-word="{{ entry.word }}" aria-label="æ’­æ”¾ {{ entry.word }} çš„ç™¼éŸ³">
                ğŸ”Š ç™¼éŸ³
              </button>
              <form
                method="post"
                action="{{ url_for('delete_entry', entry_id=entry.id) }}"
                class="inline-form"
              >
                <button type="submit" class="btn-link btn-link--danger" aria-label="åˆªé™¤ {{ entry.word }}">
                  åˆªé™¤
                </button>
              </form>
            </div>
          </header>
          <div class="vocab-item__body">
            {% if entry.context %}
              <p class="vocab-item__context">ä¾‹å¥ï¼š{{ entry.context }}</p>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p>é‚„æ²’æœ‰ä»»ä½•å–®å­—ï¼Œå¿«åˆ°ã€Œæ–°å¢å–®å­—ã€é é¢é–‹å§‹å»ºç«‹ä½ çš„å–®å­—åº«å§ï¼</p>
  {% endif %}
</section>
{% endblock %}

{% block extra_scripts %}
  <script>
    (function () {
      const speakWord = (text) => {
        if (
          !text ||
          !('speechSynthesis' in window) ||
          typeof window.SpeechSynthesisUtterance !== 'function'
        ) {
          return;
        }
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.95;
        window.speechSynthesis.speak(utterance);
      };

      document.querySelectorAll('.speak-button').forEach((button) => {
        button.addEventListener('click', () => {
          const word = button.dataset.word || '';
          speakWord(word.trim());
        });
      });

    })();
  </script>
{% endblock %}
