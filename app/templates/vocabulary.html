{% extends "base.html" %}
{% block title %}å–®å­—æœ¬ï½œéš¨èº«å–®å­—æœ¬{% endblock %}
{% block content %}
<section class="card vocabulary-card">
  <div class="section-heading">
    <h2>å–®å­—æœ¬</h2>
    <p>ä»Šæ—¥å¾…è¤‡ç¿’ï¼š<strong>{{ due_count }}</strong> å€‹å–®å­—ã€‚</p>
  </div>
  {% if entries %}
    <ul class="vocabulary-list">
      {% for entry in entries %}
        <li class="vocabulary-entry">
          <div class="vocabulary-entry__headline">
            <button
              type="button"
              class="speak-button"
              data-speak-word="{{ entry.word }}"
              aria-label="æ’­æ”¾ {{ entry.word }} çš„ç™¼éŸ³"
            >
              ğŸ”ˆ
            </button>
            <strong class="vocabulary-entry__word">{{ entry.word }}</strong>
            <span class="vocabulary-entry__separator">â€”</span>
            <span class="vocabulary-entry__definition">{{ entry.definition }}</span>
          </div>
          {% if entry.context %}
            <p class="vocabulary-entry__context">{{ entry.context }}</p>
          {% endif %}
          <p class="vocabulary-entry__meta">
            ä¸‹ä¸€æ¬¡è¤‡ç¿’ï¼š{{ entry.next_review }} ï½œ é€£å‹ï¼š{{ entry.success_streak }} ï½œ è¤‡ç¿’æ¬¡æ•¸ï¼š{{ entry.review_count }}
          </p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>é‚„æ²’æœ‰å–®å­—ï¼Œè¶•å¿«æ–°å¢ä¸€å€‹å§ï¼</p>
  {% endif %}
</section>
{% endblock %}

{% block extra_scripts %}
  <script>
    (function () {
      const speakButtons = document.querySelectorAll('[data-speak-word]');
      if (!speakButtons.length) {
        return;
      }

      const supportsSpeech =
        'speechSynthesis' in window && typeof window.SpeechSynthesisUtterance !== 'undefined';
      if (!supportsSpeech) {
        speakButtons.forEach((btn) => {
          btn.disabled = true;
          btn.classList.add('speak-button--disabled');
          btn.title = 'ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­æ”¾';
        });
        return;
      }

      const speakWord = (text) => {
        if (!text) {
          return;
        }
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.95;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      };

      speakButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const word = btn.getAttribute('data-speak-word');
          speakWord(word);
        });
      });
    })();
  </script>
{% endblock %}
